package com.orangeHRM.pages;

import org.openqa.selenium.WebDriver;
import org.testng.annotations.*;
import utils.BaseTest;

import java.time.Duration;

@Listeners(utils.TestListener.class)
public class OrangeHRMTest extends BaseTest {
    WebDriver driver;

    @BeforeMethod
    public void setup() {
        driver = getDriver();  
        driver.manage().window().maximize();
        driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(10));
        driver.get("https://opensource-demo.orangehrmlive.com/web/index.php/auth/login");
    }

    @Test(dataProvider = "employeeData")
    public void AllData(String adminUser, String adminPass,
                        String firstName, String middleName, String lastName,
                        String newUsername, String newPassword) throws InterruptedException {

        // Login with admin
        LoginPage loginPage = new LoginPage(driver);
        loginPage.login(adminUser, adminPass);

        // Add new employee
        DashboardPage dashboard = new DashboardPage(driver);
        UserManagementPage userMgmt = new UserManagementPage(driver);
        AddEmployeePage addEmp = new AddEmployeePage(driver);

        userMgmt.goToPIMTab();
        Thread.sleep(1000);
        userMgmt.clickAddButton();
        addEmp.addEmployee(firstName, middleName, lastName, newUsername, newPassword);
        Thread.sleep(3000);

        // Logout after adding
        dashboard.logout();

        // Login with new employee
        loginPage.login(newUsername, newPassword);
        Thread.sleep(3000);
        String loggedUser = dashboard.getLoggedInUsername();
        System.out.println("Logged in as: " + loggedUser);

        // Get employee ID
        dashboard.clickMyInfo();
        Thread.sleep(3000);
        String empId = dashboard.getEmployeeId();
        System.out.println("Employee ID: " + empId);

        // Logout
        dashboard.logout();

        // Login again as Admin & delete created user
        loginPage.login(adminUser, adminPass);
        userMgmt.goToAdminTab();
        userMgmt.searchUser(newUsername);
        userMgmt.deleteSearch();
        System.out.println("Deleted employee: " + newUsername);

        // Final logout
        dashboard.logout();
    }

    @DataProvider(name = "employeeData")
    public Object[][] provideEmployeeData() {
        return new Object[][] {
            {"Admin", "admin123", "Anjan", "Kumar", "Roy", "AnjanTest123", "Zxcv@786b"},
        };
    }

    @AfterMethod
    public void close() {
        if (driver != null) {
            driver.quit();  
            driver = null;  
        }
    }
}
